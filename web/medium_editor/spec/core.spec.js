describe("Core",function(){beforeEach(function(){$("body").append('<div id="fixtures"><div class="editable"></div></div>'),this.$el=$(".editable"),jasmine.clock().install()}),afterEach(function(){$("#fixtures").remove(),jasmine.clock().uninstall()}),it("initializes plugin",function(){this.$el.mediumInsert(),expect(this.$el.hasClass("medium-editor-insert-plugin")).toBe(!0)}),it("initializes plugin on a textarea",function(){var e;$("#fixtures").html('<div medium-editor-textarea-id="123"></div><textarea id="textarea" medium-editor-textarea-id="123">test</textarea>'),this.$el=$("#textarea"),this.$el.mediumInsert(),e=this.$el.attr("medium-editor-textarea-id"),expect(this.$el.hasClass("medium-editor-insert-plugin")).toBe(!1),expect(this.$el.siblings('[medium-editor-textarea-id="'+e+'"]').hasClass("medium-editor-insert-plugin")).toBe(!0)}),it("initializes addons",function(){spyOn($.fn,"mediumInsertImages"),this.$el.data("plugin_mediumInsertImages",{options:{}}),this.$el.mediumInsert(),expect($.fn.mediumInsertImages.calls.count()).toEqual(1)}),it("does nothing if there is no addon selected",function(){this.$el.mediumInsert({addons:!1}),expect(this.$el.html()).toBe("")}),it("adds empty paragraph if there is no content",function(){this.$el.mediumInsert(),expect(this.$el.find("p").length).toEqual(1)}),it("wraps <br> into paragraph",function(){this.$el.html("<br>"),this.$el.mediumInsert(),expect(this.$el.find("p").length).toEqual(1),expect(this.$el.find("br").length).toEqual(1)}),it("wraps text content into paragraph",function(){this.$el.html("text"),this.$el.mediumInsert(),expect(this.$el.find("p").length).toEqual(1)}),it("adds empty paragraph at the end if the last element is an addon element",function(){this.$el.html('<div class="medium-insert-images"></div>'),this.$el.mediumInsert(),expect(this.$el.find(".medium-insert-images").next().is("p")).toBe(!0)}),it("adds plugin's buttons to the $el",function(){this.$el.mediumInsert(),expect(this.$el.find(".medium-insert-buttons").length).toEqual(1)}),it("shows plugin's buttons after clicking on empty paragraph",function(){this.$el.html('<p id="paragraph">&nbsp;</p><p id="paragraph2" class="medium-insert-active">test</p>'),this.$el.mediumInsert(),placeCaret(document.getElementById("paragraph"),0),this.$el.find("#paragraph").click(),jasmine.clock().tick(1),expect(this.$el.find(".medium-insert-buttons").css("display")).toBe("block"),expect(this.$el.find("#paragraph").hasClass("medium-insert-active")).toBe(!0),expect(this.$el.find("#paragraph2").hasClass("medium-insert-active")).toBe(!1)}),it("shows only addon button after clicking on addon paragraph",function(){this.$el.html('<p id="paragraph" class="medium-insert-images">&nbsp;</p><p id="paragraph2" class="medium-insert-active">test</p>'),this.$el.mediumInsert(),placeCaret(document.getElementById("paragraph"),0),this.$el.find("#paragraph").click(),jasmine.clock().tick(101),expect(this.$el.find(".medium-insert-buttons").css("display")).toBe("block"),expect(this.$el.find('.medium-insert-buttons a[data-addon="embeds"]').parent().css("display")).toBe("none")}),it("hides plugin's buttons after clicking on non-empty paragraph",function(){this.$el.html('<p>&nbsp;</p><p id="paragraph2">test</p>'),this.$el.mediumInsert(),placeCaret(document.getElementById("paragraph2"),0),this.$el.find("#paragraph2").click(),expect(this.$el.find(".medium-insert-buttons").css("display")).toBe("none")}),it("toggles addons buttons after clicking on show button",function(){this.$el.html('<p id="paragraph">&nbsp;</p><p>test</p>'),this.$el.mediumInsert(),placeCaret(document.getElementById("paragraph"),0),this.$el.find("#paragraph").click(),this.$el.find(".medium-insert-buttons-show").click(),expect(this.$el.find(".medium-insert-buttons-addons").css("display")).toBe("block"),expect(this.$el.find(".medium-insert-buttons-show").hasClass("medium-insert-buttons-rotate")).toBe(!0),this.$el.find(".medium-insert-buttons-show").click(),expect(!this.$el.find(".medium-insert-buttons-show").hasClass("medium-insert-buttons-rotate")).toBe(!0)}),it("calls addon's add function if addon's button is clicked",function(){var e;this.$el.html('<p id="paragraph">&nbsp;</p><p>test</p>'),this.$el.mediumInsert({addons:{embeds:!1}}),e=this.$el.data("plugin_mediumInsertImages"),spyOn(e,"add"),placeCaret(document.getElementById("paragraph"),0),this.$el.find("#paragraph").click(),this.$el.find(".medium-insert-buttons-show").click(),this.$el.find(".medium-insert-action").click(),expect(e.add.calls.count()).toBe(1)}),it("removes also plugin buttons on serialization",function(){var e=new MediumEditor(".editable");this.$el.mediumInsert({editor:e}),expect(e.serialize()["element-0"].value).toBe("<p><br></p>")}),it("disables plugin on editor destroy",function(){var e=new MediumEditor(this.$el.get(0));this.$el.mediumInsert({editor:e}),e.destroy(),expect(this.$el.data("plugin_mediumInsert").options.enabled).toBe(!1)}),it("enables plugin on editor setup",function(){var e=new MediumEditor(this.$el.get(0));this.$el.mediumInsert({editor:e}),e.setup(),expect(this.$el.data("plugin_mediumInsert").options.enabled).toBe(!0)}),it("displays placeholder dispite of plugin buttons",function(){var e=new MediumEditor(this.$el.get(0));this.$el.mediumInsert({editor:e}),e.getExtensionByName("placeholder").updatePlaceholder(this.$el.get(0)),expect(this.$el.hasClass("medium-editor-placeholder")).toBe(!0)}),it("hides placeholder when there is a text",function(){var e=new MediumEditor(this.$el.get(0));this.$el.mediumInsert({editor:e}),this.$el.addClass("medium-editor-placeholder"),this.$el.prepend("<p>asd</p>"),e.getExtensionByName("placeholder").updatePlaceholder(this.$el.get(0)),expect(this.$el.hasClass("medium-editor-placeholder")).toBe(!1)})});