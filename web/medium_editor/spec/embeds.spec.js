describe("Embeds addon",function(){beforeEach(function(){$("body").append('<div id="fixtures"><div class="editable"></div></div>'),this.$el=$(".editable"),this.editor=new MediumEditor(this.$el.get(0)),this.$el.mediumInsert({editor:this.editor,embeds:{oembedProxy:!1}}),this.addon=this.$el.data("plugin_mediumInsertEmbeds"),jasmine.clock().install()}),afterEach(function(){$("#fixtures").remove(),jasmine.clock().uninstall()}),it("toggles placeholder",function(){var e=this.$el.find("p").first();this.$el.append('<div id="p2">&nbsp;</div>'),e.click(),this.$el.find(".medium-insert-buttons-show").click(),this.$el.find('.medium-insert-action[data-addon="embeds"]').click(),expect(this.$el.find(".medium-insert-embeds-input").length).toEqual(1),expect(this.$el.find(".medium-insert-embeds-input").is("div")).toBe(!0),placeCaret(this.$el.find("#p2").get(0),0),this.$el.click(),expect(this.$el.find(".medium-insert-embeds-input").length).toEqual(0)}),it("removes empty placeholder on backspace",function(){var e=$.Event("keydown");e.which=8,this.$el.prepend('<p class="medium-insert-embeds-input medium-insert-embeds-active"></p>'),this.$el.trigger(e),expect(this.$el.find(".medium-insert-embeds-input").length).toEqual(0)}),it("supports selecting embed",function(){this.$el.prepend('<div class="medium-insert-embeds"><figure></figure><div class="medium-insert-embeds-overlay"></div></div>'),this.$el.find(".medium-insert-embeds-overlay").click(),jasmine.clock().tick(50),expect(this.$el.find(".medium-insert-embeds").hasClass("medium-insert-embeds-selected")).toBe(!0),expect($(".medium-insert-embeds-toolbar").length).toEqual(1),expect($(".medium-insert-embeds-toolbar2").length).toEqual(1),expect(this.$el.find("figcaption").length).toEqual(1)}),it("supports disabling captions",function(){$("#fixtures").html('<div class="editable"><div class="medium-insert-embeds"><figure></figure><div class="medium-insert-embeds-overlay"></div></div></div>'),this.$el=$(".editable"),this.$el.mediumInsert({addons:{embeds:{captions:!1}}}),this.$el.find("img").click(),jasmine.clock().tick(50),expect(this.$el.find("figcaption").length).toEqual(0)}),it("removes placeholder after clicking on caption",function(){this.$el.prepend('<div class="medium-insert-embeds"><figure><figcaption class="medium-insert-caption-placeholder"></figcaption></figure><div class="medium-insert-embeds-overlay"></div></div>'),this.$el.find(".medium-insert-caption-placeholder").click(),jasmine.clock().tick(50),expect(this.$el.find("figcaption").hasClass("medium-insert-caption-placeholder")).toBe(!1)}),it("supports unselecting embed",function(){this.$el.prepend('<div class="medium-insert-embeds medium-insert-embeds-selected"><figure><figcaption></figcaption></figure></div><div class="medium-insert-embeds-toolbar"></div>'),this.$el.click(),expect(this.$el.find(".medium-insert-embeds").hasClass("medium-insert-embeds-selected")).toBe(!1),expect($(".medium-insert-embeds-toolbar").length).toEqual(0),expect($(".medium-insert-embeds-toolbar2").length).toEqual(0),expect(this.$el.find("figcaption").length).toEqual(0)}),it("removes embed on backspace",function(){var e=$.Event("keydown");e.which=8,this.$el.prepend('<div class="medium-insert-embeds medium-insert-embeds-selected"></div><div class="medium-insert-embeds-toolbar"></div>'),this.$el.trigger(e),expect(this.$el.find(".medium-insert-embeds").length).toEqual(0),expect($(".medium-insert-embeds-toolbar").length).toEqual(0)}),it("triggers input event after removing embed ",function(e){var i=$.Event("keydown");this.editor.subscribe("editableInput",function(){expect(!0).toBe(!0),e()}),i.which=8,this.$el.prepend('<div class="medium-insert-embeds medium-insert-embeds-selected"></div><div class="medium-insert-embeds-toolbar"></div>'),this.$el.trigger(i)}),it("supports chaning embed style",function(){var e;this.$el.prepend('<div class="medium-insert-embeds medium-insert-embeds-left"><div class="medium-insert-embeds-overlay"></div></div>'),e=this.$el.find(".medium-insert-embeds"),e.find(".medium-insert-embeds-overlay").click(),jasmine.clock().tick(50),$(".medium-insert-embeds-toolbar .medium-editor-action").first().click(),expect(e.hasClass("medium-insert-embeds-wide")).toBe(!0),expect(e.hasClass("medium-insert-embeds-left")).toBe(!1)}),it("triggers input event after changing embed style ",function(e){this.$el.prepend('<div class="medium-insert-embeds medium-insert-embeds-left"><div class="medium-insert-embeds-overlay"></div></div>'),this.editor.subscribe("editableInput",function(){expect(!0).toBe(!0),e()}),this.$el.find(".medium-insert-embeds-overlay").click(),jasmine.clock().tick(50),$(".medium-insert-embeds-toolbar .medium-editor-action").first().click()}),it("choosing embed style calls callback function",function(e){this.addon.options.styles.wide.added=function(){expect(!0).toBe(!0),e()},this.$el.prepend('<div class="medium-insert-embeds medium-insert-embeds-left"><div class="medium-insert-embeds-overlay"></div></div>'),placeCaret(this.$el.find("p").get(0),0),this.$el.find(".medium-insert-embeds-overlay").click(),jasmine.clock().tick(50),$(".medium-insert-embeds-toolbar .medium-editor-action").first().click()}),it("calls callback function after clicking on embed action ",function(e){this.addon.options.actions.remove.clicked=function(){expect(!0).toBe(!0),e()},this.$el.prepend('<div class="medium-insert-embeds medium-insert-embeds-left"><div class="medium-insert-embeds-overlay"></div></div>'),placeCaret(this.$el.find("p").get(0),0),this.$el.find(".medium-insert-embeds-overlay").click(),jasmine.clock().tick(50),$(".medium-insert-embeds-toolbar2 .medium-editor-action").first().click()}),it("maintains backwards compatibility",function(){$("#fixtures").html('<div class="editable"><div class="medium-insert-embeds"><iframe></iframe></div></div>'),this.$el=$(".editable"),this.$el.mediumInsert(),expect(this.$el.find(".medium-insert-embeds .medium-insert-embed iframe").length).toEqual(1)}),it("supports embedding youtube",function(){var e=$.Event("keydown");e.which=13,$("#fixtures").html('<div class="editable"><p class="medium-insert-embeds-input medium-insert-embeds-active">https://www.youtube.com/watch?v=BROWqjuTM0g</p></div>'),this.$el=$(".editable"),this.$el.mediumInsert({addons:{embeds:{oembedProxy:!1}}}),this.$el.trigger(e),expect(this.$el.find(".medium-insert-embeds").length).toEqual(1),expect(this.$el.find(".medium-insert-embeds iframe").length).toEqual(1),expect(this.$el.find(".medium-insert-embeds-input").length).toEqual(0)}),it("supports embedding vimeo",function(){var e=$.Event("keydown");e.which=13,$("#fixtures").html('<div class="editable"><p class="medium-insert-embeds-input medium-insert-embeds-active">http://vimeo.com/2619976</p></div>'),this.$el=$(".editable"),this.$el.mediumInsert({addons:{embeds:{oembedProxy:!1}}}),this.$el.trigger(e),expect(this.$el.find(".medium-insert-embeds").length).toEqual(1),expect(this.$el.find(".medium-insert-embeds iframe").length).toEqual(1),expect(this.$el.find(".medium-insert-embeds-input").length).toEqual(0)}),it("support embedding instagram",function(){var e=$.Event("keydown");e.which=13,$("#fixtures").html('<div class="editable"><p class="medium-insert-embeds-input medium-insert-embeds-active">http://instagram.com/p/u7PiWCsGxj</p></div>'),this.$el=$(".editable"),this.$el.mediumInsert({addons:{embeds:{oembedProxy:!1}}}),this.$el.trigger(e),expect(this.$el.find(".medium-insert-embeds").length).toEqual(1),expect(this.$el.find(".medium-insert-embeds iframe").length).toEqual(1),expect(this.$el.find(".medium-insert-embeds-input").length).toEqual(0)}),it("converts bad embed into text",function(){var e=$.Event("keydown");e.which=13,$("#fixtures").html('<div class="editable"><p class="medium-insert-embeds-input medium-insert-embeds-active">test</p></div>'),this.$el=$(".editable"),this.$el.mediumInsert({addons:{embeds:{oembedProxy:!1}}}),this.$el.trigger(e),expect(this.$el.find(".medium-insert-embeds-input").length).toEqual(0),expect(this.$el.find("p:first").html()).toBe("test")}),it("support disabling style toolbar",function(){this.addon.options.styles=!1,this.$el.prepend('<div class="medium-insert-embeds"><figure></figure><div class="medium-insert-embeds-overlay"></div></div>'),this.$el.find(".medium-insert-embeds-overlay").click(),jasmine.clock().tick(50),expect($(".medium-insert-embeds-toolbar").length).toEqual(0),expect($(".medium-insert-embeds-toolbar2").length).toEqual(1)}),it("support disabling action toolbar",function(){this.addon.options.actions=!1,this.$el.prepend('<div class="medium-insert-embeds"><figure></figure><div class="medium-insert-embeds-overlay"></div></div>'),this.$el.find(".medium-insert-embeds-overlay").click(),jasmine.clock().tick(50),expect($(".medium-insert-embeds-toolbar").length).toEqual(1),expect($(".medium-insert-embeds-toolbar2").length).toEqual(0)}),it("adds contentediable attr and overlay on initialization",function(){$("#fixtures").html('<div class="editable"><div class="medium-insert-embeds"><figure class="medium-insert-embed"></figure></div></div>'),this.$el=$(".editable"),this.$el.mediumInsert({addons:{embeds:{}}}),expect(this.$el.find(".medium-insert-embeds").attr("contenteditable")).toBe("false"),expect(this.$el.find(".medium-insert-embeds .medium-insert-embeds-overlay").length).toEqual(1)}),it("removes also contenteditable attr and ovelay on editor's serialize",function(){var e,i,t='<div class="medium-insert-embeds"><figure class="medium-insert-embed"></figure></div>';$("#fixtures").html('<div class="editable">'+t+"</div>"),this.$el=$(".editable"),e=new MediumEditor(this.$el.get(0)),this.$el.mediumInsert({editor:e,addons:{embeds:{}}}),i=$(e.serialize()["element-0"].value),expect(i.find(".medium-insert-embeds").attr("contenteditable")).toBeUndefined(),expect(i.find(".medium-insert-embeds-overlay").length).toEqual(0)})});